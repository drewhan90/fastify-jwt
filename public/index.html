<!DOCTYPE html>
<html>
<body>
    <h1>Fasity JWT</h1>
    <div>
        <h2> Sign in as</h2>
            <button id="admin">admin</button>
            <button id="manager">manager</button>
            <button id="user">user</button>
        </div>
    <div>
        <h2> Access protected endpoints </h2>
        <button id="public">public</button>
        <button id="admin-page">admin only</button>
        <button id="manager-page">manager & admin</button>
        <button id="user-page">user & admin</button>
    </div>
    

<script>
    document.getElementById('admin').addEventListener('click', singIn('admin'))
    document.getElementById('manager').addEventListener('click', singIn('manager'))
    document.getElementById('user').addEventListener('click', singIn('user'))
    document.getElementById('admin-page').addEventListener('click', protectedRoute('admin-only'))
    document.getElementById('manager-page').addEventListener('click', protectedRoute('manager'))
    document.getElementById('user-page').addEventListener('click', protectedRoute('user'))
    document.getElementById('public').addEventListener('click', protectedRoute('public'))

    var token = ""
    function customFetch(url, options = {}) {
        return fetch(url, {
            ...options, 
            headers: {
                Authorization: `Bearer ${token}`
            }
        })
    }

    function singIn(id) {
        return function() {
            fetch('http://localhost:3000/signin', { method: 'POST', body: JSON.stringify({ id }) })
                .then(res => res.json())
                .then(data => {
                    token = data.token
                })
                .catch(err => {
                    console.log('catch')
                    console.log(err)
                })
        }
    }

    function protectedRoute(path) {
        return function() {
            console.log(path)
            customFetch(`http://localhost:3000/${path}`)
            .then(res => res.json())
            .then(data => {
                console.log(data)
            })
            .catch(err => {
                console.log('catch')
                console.log(err)
            })
        }
        
    }
</script>
</body>
</html>